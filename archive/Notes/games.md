# Gaming on Linux Setup, Utilities, Notes, and Resources

**TODO:** Livesplit/Cheat engine config and setup should go in this document as well.  
**TODO:** Steam/Lutris/VR setup  

# Steam
> _**TODO:** Still needs comprehensive documentation, the following are just notes for reference_  

**GTK4 Theming:** https://flathub.org/apps/io.github.Foldex.AdwSteamGtk  

## Notes
**Flatpak Guide:** https://steamcommunity.com/sharedfiles/filedetails/?id=2615011323  
**Flatpak Tips:** https://wiki.archlinux.org/title/Steam#Flatpak  
**Command Line:** https://developer.valvesoftware.com/wiki/Command_line_options  

## TODO
- Need to link lutris to proton runners (maybe/vice-versa so steam can use GE builds)
- Gamescope setup / Mangohud setup
- Document settings preferences
- ~~Game shortcuts~~ As the container functions, steam generates them but they are useless because they do not point correctly
- Winetricks / Protontricks??

## Flatpak Tweaks
- Allow notifications
- Add library directory `~/.var/storage/Steam:create`

### Additional notes on adding a library
For some reason this was a fucking nightmare. Instead of the steam client file dialogue like all of the guides show, steam was using a native nautilus selector. This would be nice, except that it gives the error "operation not supported." 

What is particularly weird is that one can still see all system files and select a path, except that those paths pretty much never work. My prediction (as it pertains to `/home` being persistent in the flatpak config) is that despite xdg-documents being persistent, when trying to select it (for the sake of testing) as a library directory, I anticipate the file choser specifically reports `/home/Documents` instead of the location of Flatpak's persistent instance, which would be generated by steam's requests to write to said directory. As a result, this is why Steam cannot resolve this directory as a library directory.

The frusterating issue however, is that even after adding a path with flatseal, that directory can seemingly be added as a "library" only *once.* I have zero clue why this is, but when adding my storage directory and mistakenly assuming that it failed, I removed the library and was unable to add it again, even after fully reinstalling Steam. 

What I had to do was to add some arbitray home directory folder, and then modify the `libraryfolders.vdf` file (located in two locations: `/home/.var/app/com.valvesoftware.Steam/.local/share/Steam/steamapps` and `/home/.var/app/com.valvesoftware.Steam/.local/share/Steam/config`) and tweak the path to this new directory. Further, before removing the temporary home directory, I also copied the `libraryfolder.vdf` file from the temporary location to the new location.

```jsonc
## Contents of <library dir>/libraryfolder.vdf
# The content ID was not generated by Steam but instead an all natural numpad spasm
"libraryfolder"
{
	"contentid"		"1823490523460458482"
	"label"		"Library"
}

## Contents of /home/.var/app/com.valvesoftware.Steam/.local/share/Steam/steamapps/libraryfolders.vdf
# The totalsize and update_clean_bytes_tally seem to be generated but I am not sure what should be put there for an "empty" location yet
...
"1"
{
	"path"		"<library dir>"
	"label"		"Library"
	"contentid"		"1823490523460458482"
	"totalsize"		"1967845998592"
	"update_clean_bytes_tally"		"3288611951"
	"time_last_update_corruption"		"0"
	"apps"
	{
	}
}
```

## Fixes
- Client likes to completely freeze sometimes; happens with or without `adwsteamgtk` theme installed
- `adwsteamgtk` has an unnatural title bar (changes depending on what is hovered) and the corners are not rounded

### Games not launching whatsoever
> _**TLDR:** It has something to do with having multiple steam libraries (different drives? drive format?)_  

I'm nearly certain I recall having issues with this _before_ moving to Flatpak Steam as well, though I cannot be bothered to try and test that again. Further, native Linux games do not appear to work if installed to a different drive whatsoever, even if I move the "Steam Linux Runtime" alongside it.

I have tested with the "Library" drive being formatted in both XFS and EXT4, however, the "main" drive has _only_ been tested while formatted as XFS. Symlinking does not work, both for the `steamapps/` dir as well as the `com.valvesoftware.Steam/` flatpak dir as well. I need to understand hard links better to speculate if that may work. Alternatively I could try setting `.../steamapps/` as the mountpoint for the library drive, but this is counterproductive of my goal to also install non-steam games to this drive, so it also has not been tested.

**Proton games appear to work if proton is in the "base" library, and the game itself is installed to the "storage" library.** What _appears_ to happen when things break is that a folder for the proton game will appear in the storage library (as well as the base directory) suggesting that Steam has unknowingly installed that version of proton twice. If the target version of proton is first explicitly installed to the base library, then the game can be installed like normal. That said, the better way to ensure success appears to be to _**ALWAYS**_ install the game to the base library (aka the `/var/cache` location) first! After installation, use the "move" feature to relocate the installed game (and only the game) to the storage library.  
<sub>_Dear god what a fucking nightmare._</sub>

As a possible solution less extreme could be to shutdown steam, delete any proton or steam runtime installations from `common` followed by the rest of the `steamapps` directory (excluding `compatdata` if you want to save your game settings maybe?) Then remove all contents of `apps` from the libraryfolder in the base library.  
_The nested steam in compatdata had some sort of windows-flavored config of "libaryfolders" as well...perhaps this may be a source of the issues, actually. **Needs testing.**_

## Settings
> **TODO:** This needs to be more organized, but alas for full reference

> ### Main Window (Steam -> Settings)
### Friends & Chat
```
    Ignore 'Away' status when sorting friends       :  ON
    Compact favorite friends area                   :  ON

    Dock chats to the friends list                  :  ON
    Remember my open chats                          :  OFF
```

### Notifications
```
    Play a sound when a toast is displayed          :  OFF
    When a friend joins a game                      :  OFF / OFF
    When I receive a chat room notification         :  OFF / OFF
```

### Interface
```
    24-hour clock                                   :  ON
    Start Up Location                               :  Library
    Notify me about additions or changes to games   :  OFF
```

### Library
```
    Display size for Library interface elements     :  Medium
    Low Performance Mode                            :  ON
    Disable Community Content                       :  ON
```

### Storage
Adding the dedicated library drive must be done via manually editing the configuration file, likely some unanticipated bug with the Flatpak containerization.

> _**TODO:** Library configuration (modify the `libraryfolders.vdf` file inside of `steamapps/`)_  
Further, ensure that the new library is set as default, and the orignal is named "Steam"

### In Game
```
    Restore previous tabs when starting a game          :  OFF
    In-game FPS counter                                 :  Top-right
    In-game FPS counter high contrast color             :  ON
```

### Compatibilty
```
    Enable Steam Play for all other titles              :  ON
    Run other titles with                               :  <Newest non-experimental> (Currently 9.0-1)
```

---

> ### _Archived content._

# Setup
The steam package is available in the Pacman multilib repo (the 32-bit stuff).  
See the [Arch Wiki entry](https://wiki.archlinux.org/title/Steam) for additional information.  

### Dependencies
Steam has some dependencies that have optional providers. This is not a concern on most applications as the providers add an API that exposes a feature and calls it a day.  
  
Steam's dependencies are dubious, however, as they depend on each other to an extent. (Perhaps something to do with the linux runtime packaged with Steam as well.) Notably in the case of graphics, Steam can appear to run flawlessly with the NVidia or the AMD implementations of various graphics APIs, but these APIs are not cross-compatible with eachother.  
  
I had this issue in the case of upgrading from an NVidia GPU to an AMD GPU, where I attempted to replace some of the packages for their mesa alternatives. I mistakenly missed a couple packages and Steam reported no issue. This became problematic where some games completely failed to launch with no apparently useful logging information and yet others worked perfectly as they did before the changes.  

### Launch Parameters
Edit the .desktop entry to run steam with the `-console` parameter to enable the additional tab in the GUI.  
This can be a useful tool for debugging misbehaving games.  
  
### Steam Native Runtime
(_**TODO:**_ Understand the native runtime and then describe it here)  
  
My current understanding is that steam will use the "Steam Linux Runtime" for any application it manages by default. The executable script for this is named `steam-runtime` and is what `steam` aliases to.  
  
"Steam Native Runtime" on the other hand (also referred to as `steam-native`) is what is supplied by the package, which effectively translates to `STEAM_RUNTIME=0 /usr/lib/steam/steam %command%` and therefore disabling the containerization feature present with `steam-runtime.` Using this may enable some newer features such as OpenAL, however it is not recommended as there are more likely to be dependency incompatibilities. (Think of the steam linux runtime as the LTS version.)  
  
[steam-native-runtime](https://archlinux.org/packages/multilib/x86_64/steam-native-runtime/)  
[Arch Wiki Entry](https://wiki.archlinux.org/title/Steam/Troubleshooting#Steam_runtime_issues)  
  
### Protontricks
This a python wrapper for winetricks that detects and enumerates the relevant settings for changing the steam game prefixes.  
[Github Repository](https://github.com/Matoking/protontricks)  
  
At one point, the application was crashing upon launch mysteriously. (_**TODO:**_ I can't remember the details on this fix: update this if it happens again!) The solution appeared to involve uninstalling and reinstalling (rather clean building) the `python-vdf` package as there was some form of version mismatch.  
  
### Gamescope
(_**TODO:**_ This is an interesting tool that I need to look into!)  
[gamescope](https://archlinux.org/packages/extra/x86_64/gamescope/)  
  
### Additional Interesting Packages (AUR)
- steamrun  
- steamcmd  
- steamlink  
  
# Troubleshooting
### No sound in proton games
The wine (proton) prefix can be modified to force the use of a specific sound library.  
1) Open Protontricks  
2) Select the game of interest  
3) Select default prefix (_**TODO:**_ Determine if every game has its own set of prefixes or not)  
4) Select change settings  
5) Check `sound=alsa` ~~(alternatively `sound=pulse`)~~  
6) Press OK / Close (multiple times) to apply and exit  
  
### Games are unexpectedly crashing
_(See the note on dependencies in #setup)_  
  
Otherwise, searching for the game of interest on [protondb](https://protondb.com) has proven itself an effective resource.  

### Faster shader pre-compilation
Steam can be configured to use more threads when pre-compiling shaders, see the wiki entry:  
https://wiki.archlinux.org/title/Steam#Faster_shader_pre-compilation  

### Mesa Driver Environment Variables
Many of the variables used to troubleshoot steam games are documented here:  
https://docs.mesa3d.org/envvars.html  

# Game Configuration
### Alien: Isolation
**Launch parameters**  
`DXVK_FRAME_RATE=130 __GLX_VENDOR_LIBRARY_NAME=mesa MESA_LOADER_DRIVER_OVERRIDE=zink GALLIUM_DRIVER=zink %command%`  
  
**Notes**  
Alien's native port has an incompatibility with NVidia drivers, causing the game to crash during a malloc() routine on launch.  
  
On the AMD side however, there is an incompatibility with the newer drivers (necessary for modern AMD cards) which does not crash the game, but introduces some near-unplayable bugs. To fix this, vulkan can be forced using the variables `MESA_LOADER_DRIVER_OVERRIDE=zink` and `GALLIUM_DRIVER=zink`. (See [this protondb post](https://www.protondb.com/app/214490#qmV9v6Ztp8) for additional context.) 
  
In my experience, running alien in this way gave me about a third to a half the performance of the proton version, but it was playable!
  
### Getting over it wwith Bennett Foddy
**General settings**  
Force use of a specific compatibility tool: Proton \<any\> (Linux port is an out of date version) 
  